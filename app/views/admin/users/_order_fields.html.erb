<div class="nested-fields top-space">

  <%= link_to_remove_association '<i class="icon-trash"></i>'.html_safe, f, :class => "btn btn-danger pull-right", :confirm => 'Are you sure?' %>

  <a href="" class="btn btn-info btn-mini pull-left right-space"><i class="icon-arrow-down"></i></a>
  <a href="" class="btn btn-info btn-mini pull-left right-space"><i class="icon-arrow-up"></i></a>
  <a href="" class="btn btn-info btn-mini pull-left right-space"><i class="icon-minus"></i></a>

  <div class="clearfix bottom-space"></div>

  <div class="nested-visualize" style="border-left: 3px dashed #62C462">

    <%= f.association :name, :collection => @user.names.select %>
    <%= f.association :postal_address, :collection => @user.postal_addresses.select %>

    <div id="products_inorder" class="nested-fields">

      <!-- TODO Check аналогично -->
      <% if f.object.new_record? %>
        <%= f.simple_fields_for :products do |product| %>
          <%= render 'product_fields', :f => product, :stack => stack %>
        <% end %>
      <% else %>
        <%= f.simple_fields_for :products, f.object.products.where(:status => :inorder) do |product| %>
          <%= render 'product_fields', :f => product, :stack => stack %>
        <% end %>
      <% end %>

      <div class="links">
        <%= link_to_add_association 'Добавить товар', f, :products, :class => "btn btn-success btn-success", :render_options => {:locals => {:stack => stack}}, :wrap_object => Proc.new {|product| product.status = :inorder; product} %>
      </div>

    </div>

  </div>

  <hr />

</div>

